http:
  middlewares:
    default-headers:
      headers:
        frameDeny: true
        browserXssFilter: true
        contentTypeNosniff: true
        forceSTSHeader: true
        stsIncludeSubdomains: true
        stsPreload: true
        stsSeconds: 15552000
        customFrameOptionsValue: "SAMEORIGIN"
        customRequestHeaders:
          X-Forwarded-Proto: "https"

    https-redirectscheme:
      redirectScheme:
        scheme: https
        permanent: true

  routers:
{% for route in traefik_routes | default([]) %}
    {{ route.name }}:
      entryPoints:
{% for entrypoint in route.entrypoints | default(['https']) %}
        - "{{ entrypoint }}"
{% endfor %}
      rule: "Host(`{{ route.host }}.{{ route.domain | default('${DOMAIN}') }}`)"
      middlewares:
{% for middleware in route.middlewares | default(['default-headers', 'https-redirectscheme']) %}
        - "{{ middleware }}"
{% endfor %}
      tls:
        certResolver: "{{ traefik_cert_resolver | default('cloudflare') }}"
      service: "{{ route.service | default(route.name) }}"
{% endfor %}

  services:
{% for service in traefik_services | default([]) %}
    {{ service.name }}:
      loadBalancer:
        servers:
{% for server in service.servers %}
          - url: "{{ server.url }}"
{% endfor %}
        passHostHeader: {{ service.pass_host_header | default(false) | lower }}
{% if service.health_check is defined %}
        healthCheck:
          path: "{{ service.health_check.path }}"
          interval: "{{ service.health_check.interval | default('30s') }}"
          timeout: "{{ service.health_check.timeout | default('5s') }}"
{% endif %}
{% endfor %}

